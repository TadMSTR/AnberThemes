#!/bin/bash

# Notes
#
export TERM=linux
sudo chmod 666 /dev/tty1

GamesMenu() {
	cmd=(dialog --clear --backtitle "AnberThemes" --title "[ Themes ]" --menu "Select theme from the list:" "15" "56" "15")

	options=(
		Back "Back to main menu"
		es-theme-arkos-carbon "Install or Update"
		es-theme-ChicueloAP "Install or Update"
		es-theme-custom-box "Install or Update"
		es-theme-epicnoir "Install or Update"
		es-theme-freeplay "Install or Update"
		es-theme-gbz35_mod "Install or Update"
		es-theme-magical-pixel "Install or Update"
		es-theme-minimal-arkos "Install or Update"
		es-theme-nes-box "Install or Update"
		es-theme-pixel "Install or Update"
		es-theme-solo-horizontal-arkos-ed "Install or Update"
		es-theme-switch "Install or Update"
	)

    choices=$("${cmd[@]}" "${options[@]}" 2>&1 > /dev/tty1)
   	bash ./scripts/themes/${choices[0]}
}

ExitMenu() {
	pgrep -f oga_controls | sudo xargs kill -9
	sudo systemctl restart emulationstation
}

UpdateMenu() {
	source ./scripts/helper

	dialog --backtitle "System" --infobox "\nDownloading latest release of AnberThemes ..." 5 55 > /dev/tty1
	wget -q 'https://github.com/tadmstr/AnberThemes/releases/download/1.0.0/AnberThemes.zip'

	dialog --backtitle "System" --infobox "\nExtracting ..." 5 55 > /dev/tty1
	unzip -qq -o AnberThemes.zip -d ../

	dialog --backtitle "System" --infobox "\nClearning up ..." 5 55 > /dev/tty1
	rm -rf AnberThemes.zip

	dialog --backtitle "System" --infobox "\nPlease launch AnberTheme again and enjoy ..." 5 55 > /dev/tty1
	sleep 5

	ExitMenu
}

source ./scripts/helper

#
# Joystick controls
#
sudo ./oga_controls &

#
# Main menu
#
while true; do
	cmd=(dialog --clear --backtitle "AnberThemes" --title " [ Main Menu ] " --menu "You can use UP/DOWN on the D-pad and A to select:" "10" "60" "10")

	options=(
		Themes "Install or update themes"
		Update "Check for updates"
		Exit "Exit to emulationstation"
	)

	choices=$("${cmd[@]}" "${options[@]}" 2>&1 > /dev/tty1)

	for choice in $choices; do
		case $choice in
			Themes) GamesMenu ;;
			Update) UpdateMenu ;;
			Exit) ExitMenu ;;
		esac
	done
done
